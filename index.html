<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Argument Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://unpkg.com/compromise"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; }
        button { padding: 10px 20px; font-size: 16px; }
        #output { margin-top: 20px; padding: 10px; background: #f4f4f4; white-space: pre-line; }
    </style>
</head>
<body>
    <h1>AI Argument Analyzer</h1>
    <textarea id="argumentInput" placeholder="Enter your argument here..."></textarea>
    <button onclick="analyzeArgument()">Analyze</button>
    <div id="output"></div>

    <script>
        function textToVector(text) {
            let vector = new Array(50).fill(0);
            const words = text.toLowerCase().split(" ");
            words.forEach((word, index) => {
                if (index < 50) {
                    vector[index] = word.length;
                }
            });
            return vector;
        }

        function extractStandardForm(argument) {
            const doc = nlp(argument);
            const sentences = doc.sentences().out('array');
            let premises = [];
            let conclusion = "";

            sentences.forEach((sentence, index) => {
                if (sentence.includes("therefore") || sentence.includes("thus") || sentence.includes("hence") || sentence.includes("so")) {
                    conclusion = "Conclusion: " + sentence;
                } else {
                    premises.push(`P${index + 1}: ${sentence}`);
                }
            });

            if (!conclusion && premises.length > 1) {
                conclusion = "Conclusion: " + premises.pop().replace(/^P\d+:\s*/, '');
            } else if (!conclusion) {
                conclusion = "Conclusion: [Not Explicitly Stated]";
            }

            return { premises, conclusion };
        }

        function checkValidity(standardForm) {
            const lowerForm = standardForm.toLowerCase();

            // Extract premises and conclusion
            const premise1 = standardForm.match(/p1: if (.*?), then (.*)/i);
            const premise2 = standardForm.match(/p2: (.*?)/i);
            const conclusion = standardForm.match(/conclusion: (.*?)/i);

            if (premise1 && premise2 && conclusion) {
                const ifClause = premise1[1]?.trim();
                const thenClause = premise1[2]?.trim();
                const secondPremise = premise2[1]?.trim();
                const derivedConclusion = conclusion[1]?.trim();

                // ✅ Detect **Modus Ponens (Valid)**
                if (secondPremise === ifClause && derivedConclusion === thenClause) {
                    return "✓ This argument follows Modus Ponens and is valid.";
                }

                // ❌ Detect **Affirming the Consequent (Invalid)**
                if (secondPremise === thenClause && derivedConclusion === ifClause) {
                    return "X This argument is invalid. (Affirming the Consequent Fallacy).";
                }
            }

            return "X This argument is invalid. The conclusion does not logically follow from the premises.";
        }

        function classifyArgumentType(argument) {
            const lowerCaseArg = argument.toLowerCase();
            if ((lowerCaseArg.match(/if/gi) || []).length >= 2 && (lowerCaseArg.match(/then/gi) || []).length >= 2) {
                return "Deductive"; // Hypothetical Syllogism
            } 
            if (lowerCaseArg.includes("if") && lowerCaseArg.includes("then")) {
                return "Deductive"; // Modus Ponens or Modus Tollens
            }
            if (lowerCaseArg.includes("or") && lowerCaseArg.includes("not")) {
                return "Deductive"; // Disjunctive Syllogism
            }
            return "Inductive";
        }

        async function analyzeArgument() {
            const argument = document.getElementById('argumentInput').value;
            document.getElementById('output').innerText = "Analyzing with AI...";
            
            let { premises, conclusion } = extractStandardForm(argument);
            let argumentType = classifyArgumentType(argument);
            let validityAnalysis = checkValidity(`${premises.join("\n")}\n${conclusion}`);

            document.getElementById('output').innerText = `**Standard Form:**\n${premises.join("\n")}\n${conclusion}\n\n` +
                `Type: ${argumentType}\n` +
                `Analysis: ${validityAnalysis}`;
        }
    </script>
</body>
</html>
