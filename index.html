function analyzeArgument() {
    let text = document.getElementById("argumentInput").value.trim();
    let premises = [];
    let conclusion = "";

    // Keywords to identify conclusions
    const conclusionKeywords = ["therefore", "hence", "thus", "so", "consequently"];
    
    // Improved sentence splitting: Keep "If...then" statements together
    let sentences = text.match(/(if\s[^.!?]+then\s[^.!?]+|[^.!?]+[.!?]+)/gi) || [];

    for (let sentence of sentences) {
        let lowerSentence = sentence.toLowerCase().trim();

        // Remove duplicate premise labels (fix "P1: P1:" issue)
        sentence = sentence.replace(/^P\d+:\s*/, "").trim();

        // Identify conclusions
        if (conclusionKeywords.some(word => lowerSentence.includes(word))) {
            conclusion = sentence;
        } else {
            premises.push(sentence);
        }
    }

    // Ensure the last sentence is the conclusion if not explicitly marked
    if (premises.length >= 2 && !conclusion) {
        conclusion = premises.pop();
    }

    // Step 1: Display Standard Form
    let outputHTML = "<h3>Standard Form:</h3>";
    premises.forEach((p, i) => outputHTML += `<p><strong>P${i+1}:</strong> ${p}</p>`);
    outputHTML += conclusion ? `<p><strong>Conclusion:</strong> ${conclusion}</p>` : `<p><strong>Conclusion:</strong> Not explicitly found.</p>`;

    // Step 2: Evaluate Argument Validity
    let isValid = checkValidity(premises, conclusion);
    outputHTML += isValid ? `<p class='valid'>✔ This argument is logically valid.</p>` : `<p class='invalid'>✖ This argument is invalid.</p>`;

    // Step 3: Detect Fallacies
    let fallacies = detectFallacies(premises, conclusion);
    if (fallacies.length > 0) {
        outputHTML += "<h3>Potential Fallacies Detected:</h3>";
        fallacies.forEach(f => outputHTML += `<p class='fallacy'>⚠️ ${f}</p>`);
    } else {
        outputHTML += "<p class='valid'>✅ No major logical fallacies detected.</p>";
    }

    // Step 4: Check Soundness
    let isSound = checkSoundness(premises);
    outputHTML += isSound ? `<p class='sound'>✔ This argument is sound.</p>` : `<p class='invalid'>❌ This argument is unsound.</p>`;

    document.getElementById("output").innerHTML = outputHTML;
}
